<div class="contact-panel">
  <div class="control-bar clearfix">
    <div class="status">
      {{#unless isRemoteSynced}}
        Unsynced
      {{/unless}}
    </div>
    {{#control-group name="options"}}
      {{#link-to 'contact.edit' model}}
        <i class="fa fa-pencil"></i>
        Edit
      {{/link-to}}
      <a href {{action "deleteContact"}}>
        <i class="fa fa-trash-o delete-contact"></i>
        Delete
      </a>
    {{/control-group}}
  </div>

  {{partial "partials/confirmation"}}

  <div class="clearfix">
    <div class="avatar clearfix">
      <img {{bind-attr src=pictureUrl}}></img>
      {{image-uploader resource="contacts" resourceId=id action="changeImage"}}
    </div>

    <div class="top-info">

      <h3 id="contact-name">{{name}}</h3>
        <p>
          <b>from:</b>
          {{#if city}}
            {{city}}
          {{else}}
            unknown
          {{/if}}
        </p>

        <p>
          <b>birthday:</b>
          {{#if birthday}}
            {{formatBirthday birthday}}
          {{else}}
            unknown
          {{/if}}
        </p>

        <p id="last-seen">
          <b>last seen:</b>
          {{#if lastSeen}}
            {{formatDate lastSeen}}
          {{/if}}
        </p>
        <p id="active">
          {{status}}
        </p>
    </div>
  </div>

  {{#if bio}}
    <div class="bio">
      {{breaklines bio}}
    </div>
  {{/if}}

  <div id="relationships">
    <div class="section-header">
      <div class="right">
        {{#if addingRelationship}}
          <button class="btn btn-link" {{action "cancelNewRelationship"}}>
            Cancel
          </button>
        {{else}}
          <button id="add-relationship" class="btn btn-default" {{action "newRelationship"}}>
            Add Relationship
          </button>
        {{/if}}
      </div>

      <div class="left">
        <h4>Relationships</h4>
      </div>
    </div>

    {{#if addingRelationship}}
      <div class="form-horizontal add-model-form">
        <div class="form-group">
          <label for="newRelationshipName" class="col-sm-3 control-label">name</label>

          <div class="col-sm-9">
            {{input type="text" id="newRelationshipName" class="form-control" valueBinding="newRelationship.name"}}
          </div>
        </div>

        <div class="form-group">
          <label for="newRelationshipType" class="col-sm-3 control-label">relationship</label>

          <div class="col-sm-9">
            {{input type="text"
                id="newRelationshipType"
                class="form-control"
                valueBinding="newRelationship.relationshipType"
                placeholder="father, social worker, etc."}}
          </div>
        </div>

        <div class="form-group">
          <label for="newRelationshipContactInfo" class="col-sm-3 control-label">contact info</label>

          <div class="col-sm-9">
            {{textarea id="newRelationshipContactInfo"
              class="form-control"
              valueBinding="newRelationship.contactInfo"
              placeholder="phone number, email, etc."}}
          </div>
        </div>

        <div class="form-group">
          <label for="newRelationshipNote" class="col-sm-3 control-label">notes</label>

          <div class="col-sm-9">
            {{textarea id="newRelationshipNote"
              class="form-control"
              placeholder="Any additional notes about their relationship?"
              valueBinding="newRelationship.notes"}}
          </div>
        </div>

        <div class="save-button">
          <button id="save-relationship" class="btn btn-default " {{action "saveRelationship"}}>
            Save
          </button>
        </div>
      </div>

      {{#if errors.length}}
        <ul class="errors">
          {{#each errors}}
            <li>{{this}}</li>
          {{/each}}
        </ul>
      {{/if}}

    {{/if}}

    {{#each relationships}}
      {{relationship-panel relationship=this}}
    {{else}}
       <p> There are no relationships for this person. </p>
    {{/each}}
  </div>

  <div class="connections">
    <div class="section-header">
      <div class="right">
        {{#if addingConnection}}
          <button class="btn btn-link" {{action "cancelNewConnection"}}>
            Cancel
          </button>
        {{else}}
          <button id="add-connection" class="btn btn-default" {{action "newConnection"}}>
            Add Connection
          </button>
        {{/if}}
      </div>

      <div class="left">
        <h4>Connections</h4>
      </div>
    </div>

    {{#if addingConnection}}
      <div class="add-model-form">
        <div class="connection-top-row">
          <div class="form-group connection-date-span">
            {{date-field id="newConnectionDate" date=newConnection.occurredAt}}
          </div>
          <div class="form-group connection-mode-span">
            {{view Ember.Select
              class="form-control connection-mode"
              content=modes
              id="mode"
              value=newConnection.mode}}
          </div>
        </div>

        <div class="form-group">
          {{focused-textarea id="newConnectionNote" class="form-control" placeholder="Where? What happened? Any thing they need?" valueBinding="newConnection.note"}}
        </div>


        <div class="save-button">
          <button id="save-connection" class="btn btn-default" {{action "saveConnection"}}>
            Save Connection
          </button>
        </div>
      </div>

      {{#if errors.length}}
        <ul class="errors">
          {{#each errors}}
            <li>{{this}}</li>
          {{/each}}
        </ul>
      {{/if}}
    {{/if}}


    {{#each sortedConnections}}
      {{connection-panel connection=this}}
    {{else}}
      <p> There are no connections for this person. </p>
    {{/each}}
  </div>
</div>

